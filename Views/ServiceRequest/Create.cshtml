@model FPSample.Models.Entities.ServiceRequest

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4>Request Barangay Document</h4>
        </div>
        <div class="card-body">
            <div asp-validation-summary="All" class="text-danger"></div>

            <form asp-action="Create" method="post" enctype="multipart/form-data">

                <div class="mb-3">
                    <label class="fw-bold">Select Service</label>
                    <select asp-for="ServiceId" id="serviceSelect" class="form-select">
                        <option value="">-- Choose Document --</option>
                        @foreach (var service in ViewBag.ServiceList)
                        {
                            <option value="@service.ServiceId">@service.ServiceName</option>
                        }
                    </select>
                </div>

                <div class="mb-3">
                    <label class="fw-bold">Purpose</label>
                    <select asp-for="PurposeId" id="purposeSelect" class="form-select">
                        <option value="">-- Select Document First --</option>
                    </select>
                </div>

                <div class="mb-3" id="incomeField" style="display:none;">
                    <label class="text-danger fw-bold">Gross Annual Income (Required for Cedula)</label>
                    <input asp-for="GrossAnnualIncome" type="number" step="0.01" class="form-control" />
                </div>

                <div class="mb-3" id="photoUploadField" style="display:none;">
                    <label class="text-info fw-bold">Upload 2x2 ID Picture (Required for Barangay ID)</label>
                    <input type="file" name="ProfilePicture" class="form-control" accept="image/*" />
                    <small class="text-muted">Format: JPG, PNG. Max size: 2MB</small>
                </div>

                <div class="alert alert-info mt-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Note:</strong> Once submitted, the Barangay Admin will review your request and set your official pickup date and time.
                </div>

                <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">Submit Request</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#serviceSelect').change(function () {
                var sId = $(this).val();
                var pSelect = $('#purposeSelect');
                var incomeDiv = $('#incomeField');
                var photoDiv = $('#photoUploadField');

                var selectedText = $("#serviceSelect option:selected").text().trim();

                // Toggle Cedula Field
                if (selectedText === "Cedula") {
                    incomeDiv.show();
                } else {
                    incomeDiv.hide();
                }

                // Toggle Barangay ID Field
                if (selectedText === "Barangay ID") {
                    photoDiv.show();
                } else {
                    photoDiv.hide();
                }

                pSelect.empty().append('<option value="">-- Loading... --</option>');

                if (sId) {
                    $.getJSON('/ServiceRequest/GetPurposes', { serviceId: sId }, function (data) {
                        pSelect.empty().append('<option value="">-- Select Purpose --</option>');
                        $.each(data, function (i, item) {
                            pSelect.append('<option value="' + item.purposeId + '">' + item.purposeName + '</option>');
                        });
                    }).fail(function() {
                        pSelect.empty().append('<option value="">-- Error loading purposes --</option>');
                    });
                } else {
                    pSelect.empty().append('<option value="">-- Select Document First --</option>');
                }
            });
        });
    </script>
}